<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.22.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Flexible configuration with Deferred Resources - Backbase Engineering</title>
<meta name="description" content="Deferred Resources provides flexibility beyond the standard resource-resolution approaches.">


  <meta name="author" content="Drew Hamilton">
  
  <meta property="article:author" content="Drew Hamilton">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Backbase Engineering">
<meta property="og:title" content="Flexible configuration with Deferred Resources">
<meta property="og:url" content="https://backbase.github.io/2021/06/16/android-flexible-configuration-with-deferred-resources">


  <meta property="og:description" content="Deferred Resources provides flexibility beyond the standard resource-resolution approaches.">



  <meta property="og:image" content="https://backbase.github.io/assets/images/post/deferred-resources-banner.png">





  <meta property="article:published_time" content="2021-06-16T00:00:00+00:00">






<link rel="canonical" href="https://backbase.github.io/2021/06/16/android-flexible-configuration-with-deferred-resources">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "https://backbase.github.io/"
    
  }
</script>







<!-- end _includes/seo.html -->




<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;700&display=swap" rel="stylesheet" data-optimized-fonts="true">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

  </head>

  <body class="layout--single min-vh-100 d-flex flex-column">
    <nav class="skip-links visually-hidden-focusable">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul class="list-group">
    <li class="list-group-item"><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li class="list-group-item"><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li class="list-group-item"><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<nav id="site-nav" class="navbar navbar-expand-lg navbar-dark">
  <div class="container">
    <div class="navbar-brand">
      
        <a class="site-logo text-decoration-none" href="/">
          <span class="bb-engineering-logo">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60.09 66.09">
    <g>
      <polygon
        points="9.49 20.83 18.98 20.83 18.98 11.34 18.98 1.85 9.49 1.85 0 1.85 0 11.34 9.49 11.34 9.49 20.83" />
      <path
        d="M38.98,32.76v-1.49c9.3-1.3,11.72-7.45,11.72-13.5,0-7.48-5.12-15.59-17.78-15.89h-7.61V11.34h7.61c6.69,.11,8.11,4.45,8,7.87-.23,7.66-3.67,7.88-9.59,8.05H9.49v37.96h22.69c15.26,0,20.38-8.65,20.38-17.68,0-7.72-2.7-13.39-13.58-14.79Zm-6.52,22.9h-13.31v-19.17h13.31c8.04,0,10.63,1.52,10.63,9.74,0,6.91-2.59,9.42-10.63,9.42Z" />
    </g>
  </svg>
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="60.09 0 330.12 66.09" class="d-none d-lg-block">
    <g>
      <path
        d="M60.04,49.8c0-8.1,5.31-16.29,16.66-16.29,6.52,0,10.15,1.86,12.94,5.59v-12.1h-24.2v-8.38h33.51V55.85h5.59v9.31h-14.89v-4.65c-2.79,3.72-6.42,5.59-12.94,5.59-11.36,0-16.66-8.19-16.66-16.29Zm29.6,0c0-4.65-3.35-7.91-10.15-7.91s-10.15,3.26-10.15,7.91,3.35,7.91,10.15,7.91,10.15-3.26,10.15-7.91Z" />
      <path
        d="M108.72,41.89c0-14.61,7.17-24.2,20.85-24.2,12.19,0,19.36,7.54,19.36,18.62h-9.31c-.37-5.77-2.33-10.24-9.59-10.24-8.66,0-12.01,3.72-12.01,15.82s3.35,15.82,12.01,15.82c7.26,0,9.22-4.47,9.59-10.24h9.31c0,11.08-7.17,18.62-19.36,18.62-13.68,0-20.85-9.59-20.85-24.2Z" />
      <path
        d="M167.08,46.17v18.99h-9.31V0h9.31V37.79h7.26l13.03-19.18h11.26l-15.92,23.36,15.92,23.18h-11.26l-13.03-18.99h-7.26Z" />
      <path
        d="M249.18,41.89c0,13.68-5.31,24.2-20.39,24.2-6.52,0-11.08-2.51-13.87-6.52v5.59h-9.31V0h9.31V24.2c2.79-4,7.35-6.52,13.87-6.52,15.08,0,20.39,10.52,20.39,24.2Zm-9.31,0c0-11.17-3.35-15.82-12.47-15.82s-12.47,4.65-12.47,15.82,3.35,15.82,12.47,15.82,12.47-4.65,12.47-15.82Z" />
      <path
        d="M255.24,49.8c0-8.1,5.31-16.29,16.66-16.29,6.52,0,10.15,1.86,12.94,5.59v-12.1h-24.2v-8.38h33.51V55.85h5.59v9.31h-14.89v-4.65c-2.79,3.72-6.42,5.59-12.94,5.59-11.36,0-16.66-8.19-16.66-16.29Zm29.6,0c0-4.65-3.35-7.91-10.15-7.91s-10.15,3.26-10.15,7.91,3.35,7.91,10.15,7.91,10.15-3.26,10.15-7.91Z" />
      <path
        d="M306.71,60.13v-9.4c8.47,5.31,12.85,6.98,19.73,6.98,6.05,0,8.19-2.61,8.19-5.49,0-3.26-2.42-5.03-10.98-6.89-13.31-2.89-16.94-7.26-16.94-14.61,0-7.73,6.61-13.03,16.57-13.03,6.24,0,12.38,1.68,16.94,4.84v8.38c-6.8-3.35-12.75-4.84-17.87-4.84-4.75,0-6.33,2.05-6.33,4.37,0,2.61,1.21,4.37,9.12,6.52,13.78,3.72,18.8,6.61,18.8,15.17,0,7.91-6.61,13.96-17.5,13.96-7.26,0-12.94-1.4-19.73-5.96Z" />
      <path
        d="M350,41.89c0-14.61,5.77-24.2,20.11-24.2s20.11,8.66,20.11,23.27v5.12h-30.72c.65,6.52,3.26,11.64,14.15,11.64,3.72,0,7.35,0,13.4-1.68v8.19c-7.26,1.86-9.87,1.86-13.4,1.86-21.04,0-23.64-14.99-23.64-24.2Zm30.9-4.19c-.19-8.1-3.26-11.64-10.8-11.64s-10.33,4.1-10.8,11.64h21.6Z" />
    </g>
  </svg>
  <span class="visually-hidden">Backbase Engineering</span>
</span>

        </a>
      
    </div>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end me-4" id="navbarSupportedContent">
      <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="https://workatbackbase.com/" target="_blank">
                <span>Jobs</span>
              </a>
            </li>
          
            <li class="nav-item">
              <a class="nav-link" href="/about" >
                <span>About</span>
              </a>
            </li>
          </ul>
    </div>
        <ul class="navbar-nav" style="text-align:right;">
          <li class="nav-item">
            <a class="nav-primarylink" href="/principles"  style="text-decoration:none;">
              <span>Our Principles</span>
            </a>
          </li>
        </ul>
      
  </div>
</nav>


    <div class="initial-content">
      





<div id="main" role="main">
  <div class="container">
    <div class="row">
      <article class="page offset-md-2 col-md-8" itemscope itemtype="http://schema.org/CreativeWork">
        <meta itemprop="headline" content="Flexible configuration with Deferred Resources">
        <meta itemprop="description" content="Deferred Resources provides flexibility beyond the standard resource-resolution approaches.">
        <meta itemprop="datePublished" content="June 16, 2021">
        

        <div class="page__inner-wrap">
          
            <header>
              <h1 class="page__title" itemprop="headline">Flexible configuration with Deferred Resources
</h1>

              <aside class="author">
                
                  

<div itemscope itemtype="https://schema.org/Person">
  
    <div class="author__avatar">
      
        <img class="rounded-circle" src="/assets/images/avatars/drew.jpg" alt="Drew Hamilton" itemprop="image">
      
    </div>
  

  <div class="author__content text-muted">
    
      <h3 class="author__name" itemprop="name">Drew Hamilton</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>(Former) Principal Mobile Engineer - R&amp;D</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <div class="author__urls social-icons">
      

      

      

      

      

      

    </div>
  </div>
</div>

                
              </aside>

              
              

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <time datetime="2021-06-16T00:00:00+00:00">June 16, 2021</time>
      </span>
    

    

    
      
      

      <span class="page__meta-readtime small text-muted">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    

  </p>



              
            </header>
          

          <section class="page__content" itemprop="text">
            <p><img src="/assets/images/post/deferred-resources-banner.png" alt="" /></p>

<p>Our feature libraries, which include UI, have a number of varying requirements regarding
configuration by our customers. (My colleague Hari wrote about one such library’s requirements
<a href="/2020/08/14/android-configuration-driven-ui-from-epoxy-to-compose">here</a>.)
Resources (text, colors, images, etc.) are a common type of configuration, and can be defined in
various ways—typically in code, resources, or theme attributes. We created
<a href="https://engineering.backbase.com/DeferredResources">Deferred Resources</a> to support such
configurations, and with it our customers can consistently declare configuration properties from
any of these common sources:</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">SomeConfiguration</span> <span class="p">{</span>
    <span class="n">textColor</span> <span class="p">=</span> <span class="nc">DeferredColor</span><span class="p">.</span><span class="nc">Constant</span><span class="p">(</span><span class="nc">Color</span><span class="p">.</span><span class="nc">WHITE</span><span class="p">)</span>
    <span class="c1">// or</span>
    <span class="n">textColor</span> <span class="p">=</span> <span class="nc">DeferredColor</span><span class="p">.</span><span class="nc">Resource</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">splash_text</span><span class="p">)</span>
    <span class="c1">// or</span>
    <span class="n">textColor</span> <span class="p">=</span> <span class="nc">DeferredColor</span><span class="p">.</span><span class="nc">Attribute</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">attr</span><span class="p">.</span><span class="n">colorOnSurface</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Resolved to a @ColorInt in our UI:</span>
<span class="nd">@ColorInt</span> <span class="kd">val</span> <span class="py">textColor</span> <span class="p">=</span> <span class="n">configuration</span><span class="p">.</span><span class="n">textColor</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</code></pre></div></div>

<p>This covers most of our customers’ use cases. Deferred Resources has been working well for us for
over a year now.</p>

<p>But beyond these common use cases, Deferred Resources’ design provides a lot of flexibility to
provide resources in other ways. Each deferred resource type is an interface with one or more
abstract functions to resolve the underlying resource. Thus, a user of the Deferred Resources
library can define any resource-resolution implementation they’d like. Here are some examples of
how we’re taking advantage of this flexibility.</p>

<h2 id="color-variants">Color variants</h2>

<p>The Backbase design system has a concept of “color variants,” where any theme color has lighter and
darker alternates. These variants are defined by a computed overlay: a “lighter” variant is the
base color with a 30% white overlay, while a “darker” variant is the base color with a 30% black
overlay.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">enum</span> <span class="kd">class</span> <span class="nc">ColorVariant</span><span class="p">(</span>
    <span class="nd">@ColorInt</span> <span class="k">internal</span> <span class="kd">val</span> <span class="py">overlay</span><span class="p">:</span> <span class="nc">Int</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="nc">LIGHTER</span><span class="p">(</span><span class="n">overlay</span> <span class="p">=</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">WHITE</span><span class="p">.</span><span class="nf">withAlpha</span><span class="p">(</span><span class="mh">0x4D</span><span class="p">)),</span>
    <span class="nc">DARKER</span><span class="p">(</span><span class="n">overlay</span> <span class="p">=</span> <span class="nc">Color</span><span class="p">.</span><span class="nc">BLACK</span><span class="p">.</span><span class="nf">withAlpha</span><span class="p">(</span><span class="mh">0x4D</span><span class="p">)),</span>
<span class="p">}</span>
</code></pre></div></div>

<p>By shipping a <code class="language-plaintext highlighter-rouge">DeferredVariantColor</code> class with our design system, we can make it very easy for our
feature libraries as well as for our customers to use the same variants:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Convert a [DeferredColor] to a [variant] of the same color without resolving it
 * yet.
 */</span>
<span class="k">public</span> <span class="k">fun</span> <span class="nc">DeferredColor</span><span class="p">.</span><span class="nf">variant</span><span class="p">(</span><span class="n">variant</span><span class="p">:</span> <span class="nc">ColorVariant</span><span class="p">):</span> <span class="nc">DeferredColor</span> <span class="p">=</span>
  <span class="nc">DeferredVariantColor</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">variant</span><span class="p">)</span>

<span class="c1">// See https://github.com/drewhamilton/Poko for more on the @Poko annotation</span>
<span class="nd">@Poko</span> <span class="k">internal</span> <span class="kd">class</span> <span class="nc">DeferredVariantColor</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">base</span><span class="p">:</span> <span class="nc">DeferredColor</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">variant</span><span class="p">:</span> <span class="nc">ColorVariant</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">DeferredColor</span> <span class="p">{</span>

    <span class="cm">/**
     * Using [context], resolve the base color with the variant applied.
     */</span>
    <span class="nd">@ColorInt</span> <span class="k">override</span> <span class="k">fun</span> <span class="nf">resolve</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">=</span>
        <span class="nc">ColorUtils</span><span class="p">.</span><span class="nf">compositeColors</span><span class="p">(</span><span class="n">variant</span><span class="p">.</span><span class="n">foreground</span><span class="p">,</span> <span class="n">base</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>

    <span class="cm">/**
     * Using [context], resolve the base color with the variant applied.
     *
     * This implementation does not support states other than the default state.
     */</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">resolveToStateList</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">ColorStateList</span> <span class="p">=</span>
        <span class="nc">ColorStateList</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="nf">resolve</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With this, anyone using our design system can convert any configured color to a variant of the same
color, even if the base color comes from an outside source and its value has not been resolved yet.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">SomeConfiguration</span> <span class="p">{</span>
    <span class="n">buttonColor</span> <span class="p">=</span> <span class="nc">DeferredColor</span><span class="p">.</span><span class="nc">Attribute</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">attr</span><span class="p">.</span><span class="n">colorPrimary</span><span class="p">)</span>
    <span class="n">buttonRippleColor</span> <span class="p">=</span> <span class="n">buttonColor</span><span class="p">.</span><span class="nf">variant</span><span class="p">(</span><span class="nc">ColorVariant</span><span class="p">.</span><span class="nc">DARKER</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="supporting-lottie-without-depending-on-it">Supporting Lottie without depending on it</h2>

<p>Some of our customers want to use <a href="https://airbnb.design/lottie/">Lottie</a> to provide fun
micro-animations to our feature libraries’ UI. Other customers don’t want to use Lottie, or don’t
want these animations at all. A custom implementation of the <code class="language-plaintext highlighter-rouge">DeferredDrawable</code> interface lets us
support Lottie animations indirectly, without actually coupling our libraries
to it or forcing our customers to take it on as a dependency.</p>

<p>As a standalone library, we ship a <code class="language-plaintext highlighter-rouge">DeferredLottieDrawable</code> class:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">DeferredLottieDrawable</span> <span class="p">:</span> <span class="nc">DeferredDrawable</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">resolve</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">LottieDrawable</span><span class="p">?</span>

    <span class="kd">class</span> <span class="nc">Resource</span><span class="p">(</span>
        <span class="nd">@RawRes</span> <span class="k">private</span> <span class="kd">val</span> <span class="py">rawRes</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">transformations</span><span class="p">:</span> <span class="nc">LottieDrawable</span><span class="p">.(</span><span class="nc">Context</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">Unit</span> <span class="p">=</span> <span class="p">{},</span>
    <span class="p">)</span> <span class="p">:</span> <span class="nc">DeferredLottieDrawable</span> <span class="p">{</span>
        <span class="k">override</span> <span class="k">fun</span> <span class="nf">resolve</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">LottieDrawable</span><span class="p">?</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">compositionResult</span> <span class="p">=</span>
                <span class="nc">LottieCompositionFactory</span><span class="p">.</span><span class="nf">fromRawResSync</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">rawRes</span><span class="p">)</span>
            <span class="k">when</span> <span class="p">(</span><span class="kd">val</span> <span class="py">exception</span> <span class="p">=</span> <span class="n">compositionResult</span><span class="p">.</span><span class="n">exception</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">null</span> <span class="p">-&gt;</span> <span class="k">return</span> <span class="n">compositionResult</span><span class="p">.</span><span class="n">value</span><span class="o">?.</span><span class="nf">asDrawable</span><span class="p">()</span><span class="o">?.</span><span class="nf">apply</span> <span class="p">{</span>
                    <span class="nf">transformations</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">throw</span> <span class="n">exception</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Other supported types are implemented too: Constant, Asset, and Stream</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">fun</span> <span class="nc">LottieComposition</span><span class="p">.</span><span class="nf">asDrawable</span><span class="p">()</span> <span class="p">=</span> <span class="nc">LottieDrawable</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
    <span class="n">composition</span> <span class="p">=</span> <span class="k">this</span><span class="nd">@asDrawable</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Thanks to the base <code class="language-plaintext highlighter-rouge">Drawable</code> class and the <code class="language-plaintext highlighter-rouge">Animatable</code> interface, which are both part of the
standard Android APIs, UI code that expects an animation can display this without knowing whether
Lottie is involved:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">paymentSuccessIndication</span> <span class="p">=</span>
    <span class="n">configuration</span><span class="p">.</span><span class="n">paymentSuccessIndication</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="n">imageView</span><span class="p">.</span><span class="nf">setImageDrawable</span><span class="p">(</span><span class="n">paymentSuccessIndication</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">paymentSuccessIndication</span> <span class="k">is</span> <span class="nc">Animatable</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">paymentSuccessIndication</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Our feature library consumers can provide a <code class="language-plaintext highlighter-rouge">DeferredLottieDrawable</code> if they are using Lottie, or
any other <code class="language-plaintext highlighter-rouge">DeferredDrawable</code> if they don’t use Lottie:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">SomeConfiguration</span> <span class="p">{</span>
    <span class="n">paymentSuccessIndication</span> <span class="p">=</span> <span class="nc">DeferredLottieDrawable</span><span class="p">.</span><span class="nc">Raw</span><span class="p">(</span>
        <span class="nc">R</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">payment_success_animation</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="n">repeatCount</span> <span class="p">=</span> <span class="nc">LottieDrawable</span><span class="p">.</span><span class="nc">INFINITE</span>
    <span class="p">}</span>
    <span class="c1">// or</span>
    <span class="n">paymentSuccessIndication</span> <span class="p">=</span> <span class="nc">DeferredDrawable</span><span class="p">.</span><span class="nc">Resource</span><span class="p">(</span>
        <span class="nc">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">payment_success_icon</span>
    <span class="p">)</span>
    <span class="c1">// or</span>
    <span class="n">paymentSuccessIndication</span> <span class="p">=</span> <span class="nc">SomeCustomDeferredAnimatedDrawable</span><span class="p">(</span><span class="n">customInputs</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="remote-configuration">Remote configuration</h2>

<p>We’re just starting to explore another possible resource-resolution approach with Deferred
Resources: resolving values from a remote server. Imagine one of our libraries has a configuration
to enable a new feature:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">SomeConfiguration</span> <span class="p">{</span>
    <span class="n">coolNewFeatureEnabled</span> <span class="p">=</span> <span class="nc">DeferredBoolean</span><span class="p">.</span><span class="nc">Constant</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>A factory that is hooked up to a feature flagging backend could determine in the background whether
any remote configuration has changed, and surface that update when a custom <code class="language-plaintext highlighter-rouge">DeferredBoolean</code>
implementation is resolved:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">RemoteConfigApi</span> <span class="p">{</span>

    <span class="cm">/**
     * Returns the boolean value defined by [key] according to this
     * [RemoteConfigApi]'s internal state. This may return a default value
     * if the remote API call has not completed.
     */</span>
    <span class="k">fun</span> <span class="nf">getBooleanValue</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Boolean</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">FeatureFlagFactory</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">remoteConfigApi</span><span class="p">:</span> <span class="nc">RemoteConfigApi</span><span class="p">,</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">createDeferredFeatureFlag</span><span class="p">(</span><span class="n">featureName</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">DeferredBoolean</span> <span class="p">=</span>
        <span class="kd">object</span> <span class="err">: </span><span class="nc">DeferredBoolean</span> <span class="p">{</span>
            <span class="k">override</span> <span class="k">fun</span> <span class="nf">resolve</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span>
                <span class="n">remoteConfigApi</span><span class="p">.</span><span class="nf">getBooleanValue</span><span class="p">(</span><span class="n">featureName</span><span class="p">)</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The consuming app can fetch the remote values in the background when the app is launched and use
this factory to create its deferred feature flag, and the feature will be enabled depending on
whatever the configuration backend has returned:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">remoteConfigApi</span> <span class="p">=</span> <span class="nc">MyRemoteConfigApi</span><span class="p">(</span>
    <span class="n">url</span> <span class="p">=</span> <span class="s">"example.com"</span><span class="p">,</span>
    <span class="n">defaultValues</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span><span class="s">"coolNewFeature"</span> <span class="n">to</span> <span class="k">false</span><span class="p">),</span>
<span class="p">).</span><span class="nf">also</span> <span class="p">{</span>
    <span class="n">coroutineScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">fetchLatestValues</span><span class="p">()</span> <span class="p">}</span>
<span class="p">}</span>
<span class="kd">val</span> <span class="py">featureFlagFactory</span> <span class="p">=</span> <span class="nc">FeatureFlagFactory</span><span class="p">(</span><span class="n">remoteConfigApi</span><span class="p">)</span>

<span class="nc">SomeConfiguration</span> <span class="p">{</span>
    <span class="n">coolNewFeatureEnabled</span> <span class="p">=</span>
        <span class="n">featureFlagFactory</span><span class="p">.</span><span class="nf">createDeferredFeatureFlag</span><span class="p">(</span><span class="s">"coolNewFeature"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We’re still working on this API’s design, but just like our Lottie support, we aim to ship remote
configuration support for our customers that want it, while not forcing it on the customers who
don’t.</p>

<hr />

<p>All three of these utilizations of Deferred Resources have one thing in common: they decouple the
specific feature in question from the consumption site—our feature libraries. With this
abstraction, our feature libraries are almost limitlessly flexible while remaining uncoupled from
any specialized resource-resolution approach.</p>

            
          </section>

          <footer class="page__meta">
            
            


          </footer>

          <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Flexible+configuration+with+Deferred+Resources%20https%3A%2F%2Fbackbase.github.io%2F2021%2F06%2F16%2Fandroid-flexible-configuration-with-deferred-resources" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fbackbase.github.io%2F2021%2F06%2F16%2Fandroid-flexible-configuration-with-deferred-resources" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fbackbase.github.io%2F2021%2F06%2F16%2Fandroid-flexible-configuration-with-deferred-resources" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

        </div>

        
      </article>
    </div>

    
    
      <div class="page__related col-md-8 offset-md-2">
        
        <div class="grid__wrapper row">
          
            



<div class="grid__item col-12 col-md-6 mb-4">
  <article class="archive__item card" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser ">
        <img src="/assets/images/post/angular_microfrontends.png" alt="Micro Frontends" class="rounded-top">
      </div>
    
    <div class="card-body d-flex flex-column">
      <h2 class="archive__item-title no_toc">
        
          <a class="text-decoration-none" href="/2023/12/13/setup-microfrontend" rel="permalink">Angular &amp; Micro Frontends
</a>
        
      </h2>
      

  <p class="page__meta">
    
      
      <span class="page__meta-readtime small text-muted">
      By
      
        Harsh Julka
      
      </span>
      
    

    

    
      
      

      <span class="page__meta-readtime small text-muted">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    

  </p>


      <p class="archive__item-excerpt" itemprop="description">Micro Frontends is a modern architectural approach for developing web applications.
</p>
      <div class="d-flex mt-auto justify-content-end">
        <a href="/2023/12/13/setup-microfrontend" rel="permalink" class="btn btn-sm btn-link stretched-link">Read more</a>
      </div>
    </div>
  </article>
</div>

          
            



<div class="grid__item col-12 col-md-6 mb-4">
  <article class="archive__item card" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser ">
        <img src="/assets/images/post/azure-banner.png" alt="System Engineering" class="rounded-top">
      </div>
    
    <div class="card-body d-flex flex-column">
      <h2 class="archive__item-title no_toc">
        
          <a class="text-decoration-none" href="/2023/11/21/a-new-chapter-exploring-azure-resources" rel="permalink">A New Chapter: Exploring Azure Resources
</a>
        
      </h2>
      

  <p class="page__meta">
    
      
      <span class="page__meta-readtime small text-muted">
      By
      
        Sri Balaji, 
      
        Ashish Arora
      
      </span>
      
    

    

    
      
      

      <span class="page__meta-readtime small text-muted">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    

  </p>


      <p class="archive__item-excerpt" itemprop="description">Azure’s limitless potential sets the stage for a promising journey, where opportunities abound on the horizon.
</p>
      <div class="d-flex mt-auto justify-content-end">
        <a href="/2023/11/21/a-new-chapter-exploring-azure-resources" rel="permalink" class="btn btn-sm btn-link stretched-link">Read more</a>
      </div>
    </div>
  </article>
</div>

          
            



<div class="grid__item col-12 col-md-6 mb-4">
  <article class="archive__item card" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser ">
        <img src="/assets/images/post/visual-testing-banner.png" alt="Quality Assistance Approach" class="rounded-top">
      </div>
    
    <div class="card-body d-flex flex-column">
      <h2 class="archive__item-title no_toc">
        
          <a class="text-decoration-none" href="/2023/11/03/visual-testing-using-playwright" rel="permalink">Visual Testing using Playwright
</a>
        
      </h2>
      

  <p class="page__meta">
    
      
      <span class="page__meta-readtime small text-muted">
      By
      
        Venkata Ravi Majjari
      
      </span>
      
    

    

    
      
      

      <span class="page__meta-readtime small text-muted">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    

  </p>


      <p class="archive__item-excerpt" itemprop="description">Visual testing helps to find issues that are important for end-users that cannot be caught by other types of testing
</p>
      <div class="d-flex mt-auto justify-content-end">
        <a href="/2023/11/03/visual-testing-using-playwright" rel="permalink" class="btn btn-sm btn-link stretched-link">Read more</a>
      </div>
    </div>
  </article>
</div>

          
        </div>
      </div>
    
  </div>
</div>

    </div>

    

    <div id="footer" class="mt-auto page__footer">
      <footer class="bg-primary text-white text-center py-5 small">
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <div class="footer-brand">
    
      <a class="site-logo text-decoration-none" href="/">
        <span class="bb-engineering-logo">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60.09 66.09">
    <g>
      <polygon
        points="9.49 20.83 18.98 20.83 18.98 11.34 18.98 1.85 9.49 1.85 0 1.85 0 11.34 9.49 11.34 9.49 20.83" />
      <path
        d="M38.98,32.76v-1.49c9.3-1.3,11.72-7.45,11.72-13.5,0-7.48-5.12-15.59-17.78-15.89h-7.61V11.34h7.61c6.69,.11,8.11,4.45,8,7.87-.23,7.66-3.67,7.88-9.59,8.05H9.49v37.96h22.69c15.26,0,20.38-8.65,20.38-17.68,0-7.72-2.7-13.39-13.58-14.79Zm-6.52,22.9h-13.31v-19.17h13.31c8.04,0,10.63,1.52,10.63,9.74,0,6.91-2.59,9.42-10.63,9.42Z" />
    </g>
  </svg>
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="60.09 0 330.12 66.09" class="d-none d-lg-block">
    <g>
      <path
        d="M60.04,49.8c0-8.1,5.31-16.29,16.66-16.29,6.52,0,10.15,1.86,12.94,5.59v-12.1h-24.2v-8.38h33.51V55.85h5.59v9.31h-14.89v-4.65c-2.79,3.72-6.42,5.59-12.94,5.59-11.36,0-16.66-8.19-16.66-16.29Zm29.6,0c0-4.65-3.35-7.91-10.15-7.91s-10.15,3.26-10.15,7.91,3.35,7.91,10.15,7.91,10.15-3.26,10.15-7.91Z" />
      <path
        d="M108.72,41.89c0-14.61,7.17-24.2,20.85-24.2,12.19,0,19.36,7.54,19.36,18.62h-9.31c-.37-5.77-2.33-10.24-9.59-10.24-8.66,0-12.01,3.72-12.01,15.82s3.35,15.82,12.01,15.82c7.26,0,9.22-4.47,9.59-10.24h9.31c0,11.08-7.17,18.62-19.36,18.62-13.68,0-20.85-9.59-20.85-24.2Z" />
      <path
        d="M167.08,46.17v18.99h-9.31V0h9.31V37.79h7.26l13.03-19.18h11.26l-15.92,23.36,15.92,23.18h-11.26l-13.03-18.99h-7.26Z" />
      <path
        d="M249.18,41.89c0,13.68-5.31,24.2-20.39,24.2-6.52,0-11.08-2.51-13.87-6.52v5.59h-9.31V0h9.31V24.2c2.79-4,7.35-6.52,13.87-6.52,15.08,0,20.39,10.52,20.39,24.2Zm-9.31,0c0-11.17-3.35-15.82-12.47-15.82s-12.47,4.65-12.47,15.82,3.35,15.82,12.47,15.82,12.47-4.65,12.47-15.82Z" />
      <path
        d="M255.24,49.8c0-8.1,5.31-16.29,16.66-16.29,6.52,0,10.15,1.86,12.94,5.59v-12.1h-24.2v-8.38h33.51V55.85h5.59v9.31h-14.89v-4.65c-2.79,3.72-6.42,5.59-12.94,5.59-11.36,0-16.66-8.19-16.66-16.29Zm29.6,0c0-4.65-3.35-7.91-10.15-7.91s-10.15,3.26-10.15,7.91,3.35,7.91,10.15,7.91,10.15-3.26,10.15-7.91Z" />
      <path
        d="M306.71,60.13v-9.4c8.47,5.31,12.85,6.98,19.73,6.98,6.05,0,8.19-2.61,8.19-5.49,0-3.26-2.42-5.03-10.98-6.89-13.31-2.89-16.94-7.26-16.94-14.61,0-7.73,6.61-13.03,16.57-13.03,6.24,0,12.38,1.68,16.94,4.84v8.38c-6.8-3.35-12.75-4.84-17.87-4.84-4.75,0-6.33,2.05-6.33,4.37,0,2.61,1.21,4.37,9.12,6.52,13.78,3.72,18.8,6.61,18.8,15.17,0,7.91-6.61,13.96-17.5,13.96-7.26,0-12.94-1.4-19.73-5.96Z" />
      <path
        d="M350,41.89c0-14.61,5.77-24.2,20.11-24.2s20.11,8.66,20.11,23.27v5.12h-30.72c.65,6.52,3.26,11.64,14.15,11.64,3.72,0,7.35,0,13.4-1.68v8.19c-7.26,1.86-9.87,1.86-13.4,1.86-21.04,0-23.64-14.99-23.64-24.2Zm30.9-4.19c-.19-8.1-3.26-11.64-10.8-11.64s-10.33,4.1-10.8,11.64h21.6Z" />
    </g>
  </svg>
  <span class="visually-hidden">Backbase Engineering</span>
</span>

      </a>
    
  </div>
  <ul class="social-icons list-unstyled">
    

    
      
        
          <li><a href="https://www.youtube.com/user/Backbase" rel="nofollow noopener noreferrer" target="_blank"><i class="fab fa-youtube" aria-hidden="true"></i><span class="visually-hidden">YouTube</span></a></li>
        
      
        
          <li><a href="https://www.linkedin.com/company/backbase/" rel="nofollow noopener noreferrer" target="_blank"><i class="fab fa-linkedin-in" aria-hidden="true"></i><span class="visually-hidden">LinkedIn</span></a></li>
        
      
        
          <li><a href="https://www.instagram.com/backbase_global/" rel="nofollow noopener noreferrer" target="_blank"><i class="fab fa-instagram" aria-hidden="true"></i><span class="visually-hidden">Instagram</span></a></li>
        
      
        
          <li><a href="https://www.glassdoor.nl/Overzicht/Werken-bij-Backbase-EI_IE117266.11,19.htm?countryRedirect=true" rel="nofollow noopener noreferrer" target="_blank"><i class="fab custom-glassdoor" aria-hidden="true"></i><span class="visually-hidden">Glassdoor</span></a></li>
        
      
        
          <li><a href="https://www.facebook.com/backbase" rel="nofollow noopener noreferrer" target="_blank"><i class="fab fa-facebook-f" aria-hidden="true"></i><span class="visually-hidden">Facebook</span></a></li>
        
      
    

    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Backbase Engineering. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>


      </footer>
    </div>

    <script src='/assets/global-17ef4fa84e17b9a550efbf687d8fa54b.js' type='text/javascript'></script>


  </body>
</html>
